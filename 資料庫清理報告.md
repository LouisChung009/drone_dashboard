# Drone Tenders 資料庫清理報告

## 概述

已成功清理 `data/drone_tenders.db` 資料庫中的 `supplier_name` 欄位，將混在一起的JSON資料分解為獨立欄位。

## 問題描述

原始資料中 `supplier_name` 欄位存放著混合格式的資料：
- **文字格式**：直接的廠商名稱（如 `"DRONE ACTION 360"`）
- **JSON格式**：包含多個屬性的JSON物件（如 `{"name": "TRANSAERO, INC.", "ueiSAM": "G1EVUT8EBLV1", "cageCode": "27541"}`）

## 解決方案

### 新增欄位

在 `drone_tenders` 表格新增了三個欄位：

| 欄位 | 類型 | 說明 |
|------|------|------|
| `supplier_name_cleaned` | TEXT | 清理後的得標廠商名稱 |
| `uei_sam` | TEXT | 通用識別碼 (Unique Entity Identifier) |
| `cage_code` | TEXT | DLA國防後勤局代碼 (Commercial and Government Entity Code) |

### 資料處理

運行了資料清理指令碼 (`scripts/clean_supplier_data.py`)，將所有記錄中的資料正確提取：

```
處理 847 筆記錄:
  - JSON格式: 98 筆 (成功提取 name, ueiSAM, cageCode)
  - 文字格式: 147 筆 (直接保存廠商名稱)
  - 空值: 602 筆 (無廠商資訊)
```

## 清理結果

### 例子：TRANSAERO, INC.

| 欄位 | 值 |
|------|-----|
| supplier_name_cleaned | TRANSAERO, INC. |
| uei_sam | G1EVUT8EBLV1 |
| cage_code | 27541 |

### 統計

- **總記錄數**：847 筆（不是原本看到的 36 筆）
- **有 supplier_name_cleaned**：245 筆
- **有 uei_sam**：98 筆
- **有 cage_code**：98 筆

## 使用方法

### 1. VS Code SQLite 查詢

使用 SQL 查詢檔案 `queries/view_all_tenders.sql` 查看所有資料：

```sql
SELECT 
    id,
    source_name,
    title,
    supplier_name_cleaned as supplier_name,
    uei_sam,
    cage_code,
    award_amount,
    currency,
    award_date,
    agency
FROM drone_tenders
ORDER BY id
LIMIT 1000;
```

### 2. Python 查詢工具

安裝依賴套件：
```bash
pip install tabulate
```

**查看第 1 頁（20筆記錄）**：
```bash
python scripts/query_tenders.py 1
```

**查看第 2 頁**：
```bash
python scripts/query_tenders.py 2
```

**搜尋特定廠商**：
```bash
python scripts/query_tenders.py search "TRANSAERO"
```

### 3. 在 SQLite 中查詢

```bash
sqlite3 data/drone_tenders.db

-- 查看所有記錄
SELECT * FROM drone_tenders;

-- 查看有 UEI SAM 的記錄
SELECT id, supplier_name_cleaned, uei_sam, cage_code 
FROM drone_tenders 
WHERE uei_sam IS NOT NULL;

-- 搜尋特定廠商
SELECT * FROM drone_tenders 
WHERE supplier_name_cleaned LIKE '%TRANSAERO%';
```

## 重要說明

- **原始 `supplier_name` 欄位保留**：未修改原始資料，便於參考和回溯
- **新欄位用於查詢**：建議使用 `supplier_name_cleaned`、`uei_sam` 和 `cage_code` 進行資料分析
- **完整資料庫大小**：資料庫實際包含 847 筆記錄，VS Code SQLite 預設限制可能導致只看到部分資料

## 檔案清單

- `scripts/clean_supplier_data.py` - 資料清理指令碼
- `scripts/query_tenders.py` - 資料查詢工具
- `queries/view_all_tenders.sql` - SQL 查詢範本
- `.vscode/settings.json` - VS Code 配置（增加每頁顯示筆數）

---

最後更新: 2025-11-20
